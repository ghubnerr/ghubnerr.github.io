<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
  </head>
  <body>
    <h1>Netlify CMS Admin Panel</h1>
    <div id="ncms"></div>

    <!-- Include the Netlify CMS script -->
    <script src="https://cdn.jsdelivr.net/npm/netlify-cms@2.10.1/dist/netlify-cms.js"></script>

    <script>
      // Initialize Netlify CMS with the custom GitHub OAuth
      window.CMS_INIT = () => {
        CMS.init({
          config: "/admin/config.yml",
        });
      };

      // Check if the user session exists (e.g., token in a cookie)
      const token = document.cookie
        .split("; ")
        .find((row) => row.startsWith("token="));
      if (token) {
        console.log("User authenticated with GitHub token.");
        CMS_INIT();
      } else {
        // Redirect to the OAuth flow if no token is found
        window.location.href = "/.netlify/functions/auth";
      }

      // Wait for the page to fully load before initializing CMS
      window.onload = () => {
        CMS_INIT();
      };
    </script>
  </body>
</html>
